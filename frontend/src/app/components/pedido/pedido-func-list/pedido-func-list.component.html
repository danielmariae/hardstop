<!-- pedido.component.html -->
<div class="status-content">
  <div class="box content">
    <h1>Filtrar pedidos por status</h1>
    <form [formGroup]="statusPedidosForm">
      <label class="field label">Selecione o Status dos Pedidos:</label>
      <div class="select">
        <select formControlName="statusSelecionado">
          <option disabled selected [value]=" ">Selecione um Status de Pedidos</option>
          <option *ngFor="let tipo of statusPedidos" [value]="tipo.id">{{ tipo.descricao }}</option>
        </select>
      </div>
    </form>
  </div>
  <div class="form-group" *ngIf="statusEscolhido === 0"> <!-- Aguardando confirmação do pagamento -->
    <ng-container *ngIf="pedidoItens.length > 0">
      <div class="block" *ngFor="let item of pedidoItens">
        <div class="box content">
          <div class="columns">
            <div class="column">
              <h4>ID:</h4>
              <p>{{item.id}}</p>
            </div>
            <div class="column">
              <h4>Data/Hora da Compra:</h4>
              <p>{{getDataHoraPedido(item)}}</p>
            </div>
            <div class="column">
              <h4>Status atual:</h4>
              <p>{{getUltimoStatus(item)}}</p>
            </div>
            <div class="column">
              <h4>Total:</h4>
              <p>{{formatValues(getTotalPedido(item))}}</p>
            </div>
            <div class="column">
              <h4>Avançar pedido:</h4>
              <div class="buttons">
                <button class="button is-primary" type="button" (click)="confirmarPagamento(item.id!)">Confirmar pagamento</button>
                <button class="button is-danger" type="button" (click)="rejeitarPagamento(item.id!)">Rejeitar pagamento</button>  
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="item.id">
          <div class="box content">
            <h2>Produtos do pedido #{{item.id}}</h2>
            <div class="table-container">
              <table class="table is-fullwidth">
                <thead>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of item.itemDaVenda">
                    <td>
                      <img [src]='this.produtoService.getUrlImagem(produto.imagemPrincipal)'
                        style="max-width: 50px; max-height: 50px; object-fit: cover">
                    </td>
                    <td>
                      <h4>{{produto.nome}}</h4>
                      <p>{{produto.quantidadeUnidades}} un.:
                        {{produto.preco?.toLocaleString('PT-BR',{style:'currency', currency: 'BRL'})}} x
                        {{produto.quantidadeUnidades}}</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="form-group" *ngIf="statusEscolhido === 1"> <!-- Pagamento não autorizado pela financeira -->
    <ng-container *ngIf="pedidoItens.length > 0">
      <div class="block" *ngFor="let item of pedidoItens">
        <div class="box content">
          <div class="columns">
            <div class="column">
              <h4>ID:</h4>
              <p>{{item.id}}</p>
            </div>
            <div class="column">
              <h4>Data/Hora da Compra:</h4>
              <p>{{getDataHoraPedido(item)}}</p>
            </div>
            <div class="column">
              <h4>Status atual:</h4>
              <p>{{getUltimoStatus(item)}}</p>
            </div>
            <div class="column">
              <h4>Total:</h4>
              <p>{{formatValues(getTotalPedido(item))}}</p>
            </div>
            <div class="column">
              <h4>Finalizar pedido:</h4>
              <button class="button is-danger" type="button" (click)="deletarPedido(item.id!)">Deletar Pedido</button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <div class="form-group" *ngIf="statusEscolhido === 2"> <!-- Pagamento recebido -->
    <ng-container *ngIf="pedidoItens.length > 0">
      <div class="block" *ngFor="let item of pedidoItens; let i = index">
        <div class="box content">
          <div class="columns">
            <div class="column">
              <h4>ID:</h4>
              <p>{{item.id}}</p>
            </div>
            <div class="column">
              <h4>Data/Hora da Compra:</h4>
              <p>{{getDataHoraPedido(item)}}</p>
            </div>
            <div class="column">
              <h4>Status atual:</h4>
              <p>{{getUltimoStatus(item)}}</p>
            </div>
            <div class="column">
              <h4>Total:</h4>
              <p>{{formatValues(getTotalPedido(item))}}</p>
            </div>
            <div class="column">
              <h4>Avançar pedido:</h4>
              <button *ngIf="item.id" class="button is-primary" type="button"
                (click)="separadoDoEstoque(item.id)">Separado do
                Estoque</button>
            </div>
          </div>
        </div>
        <div *ngIf="item.id">
          <div class="box content">
            <h2>Produtos do pedido #{{item.id}}</h2>
            <div class="table-container">
              <table class="table is-fullwidth">
                <thead>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of item.itemDaVenda">
                    <td>
                      <img [src]='this.produtoService.getUrlImagem(produto.imagemPrincipal)'
                        style="max-width: 50px; max-height: 50px; object-fit: cover">
                    </td>
                    <td>
                      <h4>{{produto.nome}}</h4>
                      <p>{{produto.quantidadeUnidades}} un.:
                        {{produto.preco?.toLocaleString('PT-BR',{style:'currency', currency: 'BRL'})}} x
                        {{produto.quantidadeUnidades}}</p>
                    </td>
                    <!-- <td>
                    <button class="button is-primary" type="button" (click)="separarDoEstoque()">Separado do Estoque</button>
                  </td> -->
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="form-group" *ngIf="statusEscolhido === 3"> <!-- Separado do estoque -->
    <ng-container *ngIf="pedidoItens.length > 0">
      <div class="block" *ngFor="let item of pedidoItens; let i = index">
        <div class="box content">
          <div class="columns">
              <div class="column">
                <h4>ID:</h4>
                <p>{{item.id}}</p>
              </div>
              <div class="column">
                <h4>Data/Hora da Compra:</h4>
                <p>{{getDataHoraPedido(item)}}</p>
              </div>
              <div class="column">
                <h4>Status atual:</h4>
                <p>{{getUltimoStatus(item)}}</p>
              </div>
              <div class="column">
                <h4>Total:</h4>
                <p>{{formatValues(getTotalPedido(item))}}</p>
              </div>
              <div class="column" *ngIf="item.id">
                <h4>Avançar pedido:</h4>
                <form [formGroup]="codRastForm" class="block">
                  <input class="control input" type="text" id="codigoDeRastreamento"
                      formControlName="codigoDeRastreamento" placeholder="Código de Rastreamento">
                  <div
                      *ngIf="codRastForm.get('codigoDeRastreamento')?.hasError('required') && codRastForm.get('codigoDeRastreamento')?.touched">
                      <p class="help is-danger">Campo obrigatório.</p>
                  </div>
                </form>    
                <button class="button is-primary" type="submit">Entregue para
                  transportadora</button>    
              </div>
          </div>
        </div>
        <div *ngIf="item.id">
          <div class="box content">
            <h2>Produtos do pedido #{{item.id}}</h2>
            <div class="table-container">
              <table class="table is-fullwidth">
                <thead>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of item.itemDaVenda; let j = index">
                    <td>
                      <img [src]='this.produtoService.getUrlImagem(produto.imagemPrincipal)'
                        style="max-width: 50px; max-height: 50px; object-fit: cover">
                    </td>
                    <td>
                      <h4>{{produto.nome}}</h4>
                      <p>{{produto.quantidadeUnidades}} un.:
                        {{produto.preco?.toLocaleString('PT-BR',{style:'currency', currency: 'BRL'})}} x
                        {{produto.quantidadeUnidades}}</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <div class="form-group" *ngIf="statusEscolhido === 4"> <!-- Entregue a transportadora -->
    <ng-container *ngIf="pedidoItens.length > 0">
      <h1>Lista de pedidos</h1>

      <div class="block" *ngFor="let item of pedidoItens; let i = index">
        <div class="box content">
          <div class="columns">
            <div class="column">
              <h4>ID:</h4>
              <p>{{item.id}}</p>
            </div>
            <div class="column">
              <h4>Data/Hora da Compra:</h4>
              <p>{{getDataHoraPedido(item)}}</p>
            </div>
            <div class="column">
              <h4>Status atual:</h4>
              <p>{{getUltimoStatus(item)}}</p>
            </div>
            <div class="column">
              <h4>Código de Rastreamento:</h4>
              <p>{{getCodRastreamento(item)}}</p>
            </div>
            <div class="column">
              <h4>Total:</h4>
              <p>{{formatValues(getTotalPedido(item))}}</p>
            </div>
            <div class="column" *ngIf="item.id">
              <h4>Finalizar pedido:</h4>
              <button class="button is-primary" type="button" (click)="entregueAoCliente(item.id)">Entregue para o
                Cliente</button>    
            </div>
          </div>
        </div>
        <div *ngIf="item.id">
          <div class="box content">
            <h2>Produtos do pedido #{{item.id}}</h2>
            <div class="table-container">
              <table class="table is-fullwidth">
                <thead>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of item.itemDaVenda; let j = index">
                    <td>
                      <img [src]='this.produtoService.getUrlImagem(produto.imagemPrincipal)'
                        style="max-width: 50px; max-height: 50px; object-fit: cover">
                    </td>
                    <td>
                      <h4>{{produto.nome}}</h4>
                      <p>{{produto.quantidadeUnidades}} un.:
                        {{produto.preco?.toLocaleString('PT-BR',{style:'currency', currency: 'BRL'})}} x
                        {{produto.quantidadeUnidades}}</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <div class="form-group" *ngIf="statusEscolhido === 5"> <!-- Entregue ao Cliente -->
    <ng-container *ngIf="pedidoItens.length > 0">
      <h1>Lista de pedidos</h1>

      <div class="block" *ngFor="let item of pedidoItens; let i = index">
        <div class="box content">
          <div class="columns">
            <div class="column">
              <h4>ID:</h4>
              <p>{{item.id}}</p>
            </div>
            <div class="column">
              <h4>Data/Hora da Compra:</h4>
              <p>{{getDataHoraPedido(item)}}</p>
            </div>
            <div class="column">
              <h4>Status atual:</h4>
              <p>{{getUltimoStatus(item)}}</p>
            </div>
            <div class="column">
              <h4>Total:</h4>
              <p>{{formatValues(getTotalPedido(item))}}</p>
            </div>
            <div class="column">
              <h4>Retornar pedido:</h4>
              <button class="button is-primary" type="button" (click)="clienteDesistiu(item.id!)">Devolvido pelo
                Cliente</button>    
            </div>
          </div>
        </div>
        <div *ngIf="item.id">
          <div class="box content">
            <h2>Produtos do pedido #{{item.id}}</h2>
            <div class="table-container">
              <table class="table is-fullwidth">
                <thead>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of item.itemDaVenda; let j = index">
                    <td>
                      <img [src]='this.produtoService.getUrlImagem(produto.imagemPrincipal)'
                        style="max-width: 50px; max-height: 50px; object-fit: cover">
                    </td>
                    <td>
                      <h4>{{produto.nome}}</h4>
                      <p>{{produto.quantidadeUnidades}} un.:
                        {{produto.preco?.toLocaleString('PT-BR',{style:'currency', currency: 'BRL'})}} x
                        {{produto.quantidadeUnidades}}</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>



  <div class="form-group" *ngIf="statusEscolhido === 7"> <!-- Entregue ao Cliente -->
    <ng-container *ngIf="pedidoItens.length > 0">
      <h1>Lista de pedidos</h1>

      <div class="block" *ngFor="let item of pedidoItens; let i = index">
        <div class="box content">
          <div class="columns">
            <div class="column">
              <h4>ID:</h4>
              <p>{{item.id}}</p>
            </div>
            <div class="column">
              <h4>Data/Hora da Compra:</h4>
              <p>{{getDataHoraPedido(item)}}</p>
            </div>
            <div class="column">
              <h4>Status atual:</h4>
              <p>{{getUltimoStatus(item)}}</p>
            </div>
            <div class="column">
              <h4>Código de Rastreamento:</h4>
              <p>{{getCodRastreamento(item)}}</p>
            </div>
            <div class="column">
              <h4>Total:</h4>
              <p>{{formatValues(getTotalPedido(item))}}</p>
            </div>
          </div>
        </div>
        <div *ngIf="item.id">
          <div class="box content">
            <h2>Produtos do pedido #{{item.id}}</h2>
            <div class="table-container">
              <table class="table is-fullwidth">
                <thead>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of item.itemDaVenda; let j = index">
                    <td>
                      <img [src]='this.produtoService.getUrlImagem(produto.imagemPrincipal)'
                        style="max-width: 50px; max-height: 50px; object-fit: cover">
                    </td>
                    <td>
                      <h4>{{produto.nome}}</h4>
                      <p>{{produto.quantidadeUnidades}} un.:
                        {{produto.preco?.toLocaleString('PT-BR',{style:'currency', currency: 'BRL'})}} x
                        {{produto.quantidadeUnidades}}</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>